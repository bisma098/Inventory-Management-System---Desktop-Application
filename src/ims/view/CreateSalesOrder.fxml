<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<ScrollPane xmlns="http://javafx.com/javafx/17"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="ims.controller.CreateSalesOrderController"
            fitToWidth="true"
            hbarPolicy="NEVER">

    <content>

        <VBox spacing="20" style="-fx-background-color: #f0fdfa;">
            
            <padding>
                <Insets top="20" right="20" bottom="20" left="20"/>
            </padding>

            <!-- Header Section -->
            <HBox spacing="20" alignment="CENTER_LEFT">
                <Button text="â† Back to Sales Orders" 
                        onAction="#goBack"
                        style="-fx-background-color: #666; -fx-text-fill: white;
                               -fx-font-weight: bold; -fx-padding: 8 16;"/>
                <Label text="Create New Sales Order"
                       style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #008080;"/>
            </HBox>

            <!-- Main Form -->
            <VBox spacing="15"
                  style="-fx-background-color: white; -fx-border-color: #20B2AA;
                         -fx-border-width: 2; -fx-border-radius: 10; -fx-padding: 20;
                         -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 5, 0.3, 2, 2);">

                <!-- Customer Selection -->
                <HBox spacing="15" alignment="CENTER_LEFT">
                    <Label text="Customer:*"
                        style="-fx-font-weight: bold; -fx-text-fill: #008080;
                                -fx-min-width: 120;"/>

                    <VBox spacing="10">
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <ComboBox fx:id="customerComboBox"
                                    prefWidth="400"
                                    style="-fx-background-color: white; -fx-border-color: #008080;"
                                    promptText="Select customer"/>

                            <Button text="+ New" onAction="#toggleCustomerForm"
                                    style="-fx-background-color: #008080; -fx-text-fill: white; -fx-padding: 4 10;" />
                        </HBox>
                        
                        <!-- New Customer Form - Hidden by default -->
                        <VBox fx:id="newCustomerBox"
                            spacing="10"
                            visible="false"
                            managed="false"
                            style="-fx-background-color: #e0f7fa; -fx-padding: 15; -fx-background-radius: 8;">

                            <Label text="Create New Customer"
                                style="-fx-font-size: 16; -fx-font-weight: bold; -fx-text-fill: #008080;" />

                            <HBox spacing="10">
                                <Label text="Name:" style="-fx-font-weight: bold; -fx-min-width: 120;" />
                                <TextField fx:id="customerNameField" prefWidth="300" />
                            </HBox>

                            <HBox spacing="10">
                                <Label text="Contact:" style="-fx-font-weight: bold; -fx-min-width: 120;" />
                                <TextField fx:id="customerContactField" prefWidth="300" />
                            </HBox>

                            <HBox spacing="10" alignment="CENTER_RIGHT">
                                <Button text="Save Customer"
                                        onAction="#saveNewCustomer"
                                        style="-fx-background-color: #008080; -fx-text-fill: white; -fx-padding: 6 12;" />

                                <Button text="Cancel"
                                        onAction="#toggleCustomerForm"
                                        style="-fx-background-color: #666; -fx-text-fill: white; -fx-padding: 6 12;" />
                            </HBox>
                        </VBox>
                    </VBox>
                </HBox>

                <!-- Add Order Line (Batch-based stock tracking) -->
                <VBox spacing="10"
                      style="-fx-border-color: #ccfbf1; -fx-border-width: 1;
                             -fx-background-color: #f0fdfa; -fx-border-radius: 8; -fx-padding: 15;">

                    <Label text="Add Product to Sales Order"
                           style="-fx-font-weight: bold; -fx-text-fill: #008080; -fx-font-size: 16px;"/>

                    <GridPane hgap="15" vgap="10">
                        <columnConstraints>
                            <ColumnConstraints prefWidth="200"/>
                            <ColumnConstraints prefWidth="150"/>
                            <ColumnConstraints prefWidth="140"/>
                            <ColumnConstraints prefWidth="120"/>
                            <ColumnConstraints prefWidth="100"/>
                            <ColumnConstraints prefWidth="120"/>
                        </columnConstraints>

                        <!-- Headers -->
                        <Label text="Product"
                               style="-fx-font-weight: bold; -fx-text-fill: #008080;"
                               GridPane.rowIndex="0" GridPane.columnIndex="0"/>

                        <Label text="Batch"
                               style="-fx-font-weight: bold; -fx-text-fill: #008080;"
                               GridPane.rowIndex="0" GridPane.columnIndex="1"/>

                        <Label text="Available Qty"
                               style="-fx-font-weight: bold; -fx-text-fill: #008080;"
                               GridPane.rowIndex="0" GridPane.columnIndex="2"/>

                        <Label text="Sale Qty"
                               style="-fx-font-weight: bold; -fx-text-fill: #008080;"
                               GridPane.rowIndex="0" GridPane.columnIndex="3"/>

                        <Label text="Unit Price"
                               style="-fx-font-weight: bold; -fx-text-fill: #008080;"
                               GridPane.rowIndex="0" GridPane.columnIndex="4"/>

                        <Label text="Action"
                               style="-fx-font-weight: bold; -fx-text-fill: #008080;"
                               GridPane.rowIndex="0" GridPane.columnIndex="5"/>

                        <!-- Inputs -->
                        <ComboBox fx:id="productComboBox"
                                  prefWidth="200"
                                  promptText="Select product"
                                  onAction="#loadBatchesForProduct"
                                  style="-fx-background-color: white; -fx-border-color: #008080;"
                                  GridPane.rowIndex="1" GridPane.columnIndex="0"/>

                        <ComboBox fx:id="batchComboBox"
                                  prefWidth="150"
                                  promptText="Select batch"
                                  onAction="#showBatchInfo"
                                  style="-fx-background-color: white; -fx-border-color: #008080;"
                                  GridPane.rowIndex="1" GridPane.columnIndex="1"/>

                        <Label fx:id="availableQtyLabel"
                               text="0"
                               style="-fx-font-weight: bold; -fx-text-fill: #008080; -fx-padding: 6;"
                               prefWidth="140"
                               GridPane.rowIndex="1" GridPane.columnIndex="2"/>

                        <TextField fx:id="saleQtyField"
                                   prefWidth="100"
                                   promptText="Qty"
                                   style="-fx-background-color: white; -fx-border-color: #008080;"
                                   GridPane.rowIndex="1" GridPane.columnIndex="3"/>

                        <TextField fx:id="unitPriceField"
                                   editable="false"
                                   prefWidth="120"
                                   style="-fx-background-color: white; -fx-border-color: #008080;"
                                   GridPane.rowIndex="1" GridPane.columnIndex="4"/>

                        <Button text="Add Line"
                                onAction="#addSalesOrderLine"
                                style="-fx-background-color: linear-gradient(to bottom, #008080, #006666);
                                       -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 8 12;"
                                GridPane.rowIndex="1" GridPane.columnIndex="5"/>

                    </GridPane>
                </VBox>

                <!-- Status Message -->
            <Label fx:id="statusLabel"
                   style="-fx-text-fill: #008080; -fx-font-weight: bold;"
                   visible="false"/>

                <!-- Order Lines Table -->
                <VBox spacing="10">
                    <Label text="Sales Order Items"
                           style="-fx-font-weight: bold; -fx-text-fill: #008080; -fx-font-size: 16px;"/>

                    <TableView fx:id="orderLinesTable"
                               prefHeight="200"
                               style="-fx-border-color: #ccfbf1;">
                        <columns>
                            <TableColumn text="Product" prefWidth="200"/>
                            <TableColumn text="Batch No" prefWidth="120"/>
                            <TableColumn text="Quantity" prefWidth="100"/>
                            <TableColumn text="Unit Price" prefWidth="120"/>
                            <TableColumn text="Sub Total" prefWidth="120"/>
                            <TableColumn text="Action" prefWidth="80"/>
                        </columns>
                    </TableView>

                    <HBox spacing="10" alignment="CENTER_RIGHT">
                        <Label fx:id="totalAmountLabel" text="Total: $0.00"
                               style="-fx-font-weight: bold; -fx-font-size: 16px;
                                      -fx-text-fill: #008080; -fx-padding: 10;
                                      -fx-background-color: #ccfbf1; -fx-background-radius: 5;"/>
                    </HBox>
                </VBox>

                <!-- Submit Section -->
                <HBox spacing="15" alignment="CENTER">
                    <Button text="Create Sales Order"
                            onAction="#createSalesOrder"
                            style="-fx-background-color: linear-gradient(to bottom, #008080, #006666);
                                   -fx-text-fill: white; -fx-font-weight: bold; -fx-font-size: 14;
                                   -fx-padding: 10 20; -fx-pref-width: 200;"/>

                    <Button text="Cancel"
                            onAction="#goBack"
                            style="-fx-background-color: #E0F2F1; -fx-text-fill: #008080;
                                   -fx-font-weight: bold; -fx-border-color: #008080; -fx-border-width: 2;
                                   -fx-padding: 10 20; -fx-pref-width: 120;"/>
                </HBox>

            </VBox>

        </VBox>
    </content>
</ScrollPane>
